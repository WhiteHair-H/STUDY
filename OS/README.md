# 운영체제(Operating System)

## 프로세스(Process)와 쓰레드(Thread)
* **프로세스** : 프로그램을 메모리 상에서 실행 중인 작업
* **쓰레드** : 프로세스 안에서 실행되는 여러 흐름의 단위

![Process와 쓰레드](./images/Process_and_Thread.png)
* `Code` : 코드를 구성하는 메모리 영역(프로그램 명령)
* `Data` : 전역 변수, 정적 변수, 배열 등(초기화 된 데이터)
* `Heap` : 동적 할당 영역 (`new()`, `mallock()` 등)
* `Stack` : 지역 변수, 매개 변수, 리턴 값(임시 데이터 영역)
  
### 프로세스와 스레드의 구분 
* 기본적으로 프로세스마다 (메인쓰레드를 포함하여) 최소 1개의 쓰레드를 소유함
  * 하나의 프로세스가 생성될 때, 하나의 쓰레드가 생성됨
* 프로세스는 **자신만의 고유 공간과 자원을 할당**받아 사용하고, 쓰레드는 **다른 쓰레드와 공간, 자원을 공유**하면서 사용
  * 쓰레드는 `Stack`만 할당 받고, 나머지 영역은 다른 쓰레드와 공유해서 사용

## 멀티프로세싱과 멀티쓰레딩
### 멀티프로세싱(Multiprocessing), 다중 처리
하나의 컴퓨터에 여러 CPU를 장착해서 하나 이상의 프로세스를 동시 처리
* **장점** : 안정성(메모리 침범 문제 해결)
* **단점** : 독립된 영역으로 인해 작업량 많을 수록 오버헤드 발생, 컨텍스트 스위칭으로 인한 성능 저하
  * 프로세스는 각각 **독립된 메모리 영역**을 할당받아 사용되므로, _캐시 메모리 초기화와 같은 무거운 작업이 진행되었을 때 오버헤드가 발생할 문제가 존재_

### 멀티쓰레딩(Multithreading)
하나의 응용 프로그램에서 여러 쓰레드를 구성해 각 쓰레드가 하나의 작업을 처리하는 방법
* 쓰레드들이 **공유 메모리**를 통해 다수의 작업을 동시에 처리할 수 있게 해줌
* **장점** : 독립적인 프로세스에 비해 공유 메모리 만큼의 시간과 자원 손실이 감소, 전역 변수와 정적 변수에 대한 공유 가능
* **단점** : 공유 메모리 안정성 문제
  * 하나의 쓰레드가 데이터 공간을 망가뜨리면 모든 쓰레드가 작동 불능 상태
  * **Critical Section 방법**을 통해 공유 메모리 문제를 방지함

## 컨텍스트 스위칭(Context Switching)
프로세스의 상태 정보를 저장하고 복원하는 일련의 과정
* 멀티프로세스 환경에서 _하나의 프로세스를 실행하다가 인터럽트 요청으로 다음 우선순위의 프로세스를 실행시켜야 할 때, 컨텍스트를 교체하는 작업_ 을 말함 
* 컨텍스트 스위칭 때 프로세스는 작업을 수행하지 못하기 때문에, 컨텍스트 스위칭이 잦아지면 성능이 저하됨
* **컨텍스트 스위칭 주체** : OS 스케쥴러(Scheduler)

### 컨텍스트(Context)
CPU가 프로세스를 실행하기 위해 필요한 프로세스의 정보
* 프로세스의 PCB(Process Control Block)에 저장됨
* **PCB의 저장 정보** :
  * **프로세스 상태** : 생성, 준비, 수행, 대기, 중지
  * **프로그램 카운터** : 프로세스가 다음에 실행할 명령어 주소
  * **레지스터** : 누산기(Accumulator), 스택, 색인 레지스터
  * **프로세스 번호**
  
### 컨텍스트 스위칭이 발생하는 인터럽트(interrupt)
1. **I/O Request** : 입출력 요청
2. **Time Slice Expired** : CPU 사용 시간 만료
3. **Fork a Child** : 자식 프로세스 생성
4. **Wait for an Interrupt** : 인터럽트 처리 대기

\+ a
 
## 프로세스 스케줄링(Process Scheduling)
CPU를 사용하려는 프로세스 간의 우선순위(Priority)를 관리하는 일
* 처리율과 CPU 이용률을 증가시키고, 오버헤드/응답시간/반환시간/대기시간을 최소화 하기 위함
* = CPU가 쉬지 않고 빨리 일할 수 있도록 효율적으로 계획을 세워주는 _악덕 사장의 마음_

### 스케줄링의 목적

* **단위시간당 처리량 최대화** : 프로세서가 쉬지 않고 일을 해야함
* **적절한 반환시간 보장** : 적절한 시간 내에 input에 대한 output을 반환해야 함
* **예측 가능성 보장** : 언제, 어떻게 실행해도 거의 비슷한 시간에 비슷한 비용으로 처리 되어야 함
* **오버헤드 최소화** : 오버헤드가 발생하면 CPU 자원 낭비가 심하므로 최소화 해야 함
* **우선 순위** : 프로세스에 우선 순위를 부여해 우선 순위가 높은 프로세스를 먼저 실행 
* **자원 사용의 균형 유지** : 유휴 상태의 자원을 사용하려는 프로세스에 우선 순위를 줄 수 있음
* **자원 할당 공정성** : 모든 프로세스는 공평하게 다뤄져야 하고, 어떤 프로세스도 무제한 연기(Starvation) 되면 안됨
* **실행 대기 방지** : 실행을 무제한 연기하면 안 됨


### 스케줄링의 구분

![프로세스 스케줄링 구분](./images/Process_Scheduling.jpeg)

* **장기** : 어떤 프로세스를 **커널에 등록**할 것인지 결정
* **중기** : 어떤 프로세스에게 **메모리를 할당**할 것인지 결정
* **단기** : 어떤 프로세스에게 **CPU를 할당**할 것인지 결정

### 스케줄링 알고리즘의 종류
* **선점 스케줄링(Preemptive)** : 프로세스가 자원을 사용 중일 때, 우선순위가 더 높은 프로세스가 자원을 강탈할 수 있음
  * **장점** : 우선순위가 높은 프로세스가 빨리 처리될 수 있음
  * **단점** : 컨텍스트 스위칭이 자주 발생하므로 오버헤드가 큼 
* **비선점 스케줄링(Nonpreemptive)** : 이미 할당된 자원(프로세서)을 다른 프로세스가 강탈할 수 없음
  * **장점** : 응답 시간의 예측이 편하고, 일괄 처리 방식에 적합
  * **단점** : 덜 중요한 자원이 먼저 할당 받으면 중요한 작업을 먼저 처리할 수 없음
* **프로세서(Processor)** : CPU, 자원

***
## 참고 링크
* [OS - Context Switch(컨텍스트 스위치)가 무엇인가?](https://jeong-pro.tistory.com/93)
* [프로세스 스케쥴링(Process Scheduling)](https://junsday.tistory.com/28)
* [스케줄링(Scheduling) 개념 및 이해](https://www.crocus.co.kr/1373)
